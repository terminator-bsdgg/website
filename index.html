<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="verdammt">
        <meta name="keywords" content="lol,wtf">
        <meta name="copyright" content="IN20">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>STARTSEITE || TERMINATOR</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/fontawesome.css">
        <link rel="stylesheet" type="text/css" href="css/dataTables.bootstrap5.min.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-datetimepicker.min.css">
        <link rel="stylesheet" type="text/css" href="css/fullcalendar.min.css">
        <script src="js/jquery-3.6.0.min.js"></script>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script src="js/datatables.min.js"></script>
        <script src="js/dataTables.bootstrap5.min.js"></script>
        <script src="js/litepicker.js"></script>
        <script src="js/fullcalendar.min.js"></script>
        <script src="js/fullcalendar-locales/de.js"></script>
        <script src="js/fullcalendar-locales/en-gb.js"></script>
        <style>
            body {
                display: grid;
                grid-gap: 0;
                grid-template-rows: auto 1fr 71px;
                overflow-x: hidden;
                min-height: 100vh; 
                background-color: #fffefd;
                align-content: flex-start;
                background-image: url("img/hmm.png");
            }
            #body-overlay {
                position: absolute;
                z-index: 9999;
                width: 100%;
                height: 100%;
                opacity: 1;
                background-color: #ffffff;
                transition: opacity 1s;
                display: flex;
                align-content: center;
                align-items: center;
                justify-content: center;
            }
            #body-overlay > h1 {
                color: var(--bs-gray-500, #adb5bd);
                margin: 0
            }
            header {
                grid-column: 1 / 3;
                grid-row: 1 / 1;
                display: flex;
                flex-direction: column;
                align-self: flex-start;
                background-color: #5858b5;
                height: 50px;
                color: #fff;
                justify-content: center;
            }
            footer {
                height: 50px;
                color: white; 
                grid-column: 1 / 3;
                grid-row: 3 / 3;
                align-self: flex-end;
                background-color: #5858b5;
                text-shadow: 0 1px 0 black;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            main {
                grid-column: 1 / 3;
                grid-row: 2 / 2;
                display: flex;
                align-items: flex-start;
                justify-content: center;
                padding: 0 5%;
            }
            main > div.row:first-of-type {
                flex: 0 1 100%
            }
            #mobile-navbar {
                display: block;
                margin: auto 20px auto auto;
            }
            ul.dropdown-menu {
                box-shadow: 0 0 5px 1px #0000008a
            }
            .tab-content {
                background-color: #fffefd;
                box-shadow: 0 2px 5px 0px #00000057;
                border-left: 1px solid var(--bs-gray-300);
                border-right: 1px solid var(--bs-gray-300);
                border-bottom: 1px solid var(--bs-gray-300);
                border-bottom-left-radius: 5px;
                border-bottom-right-radius: 5px;
                border-top-right-radius: 5px;
            }
            .navbar-nav > .nav-item > .nav-link, .navbar-nav > .nav-item > .nav-link:hover, .navbar-nav > .nav-item > .nav-link:focus, .navbar-nav > .nav-item > .nav-link:visited, .navbar-nav > .nav-item >  .nav-link:active {
                color: white;
                background-color: transparent;
                transition: background-color 200ms linear 0s;
                text-shadow: 0 1px 0 black;
            }
            .navbar-nav > .nav-item > .nav-link:hover, .navbar-nav > .nav-item > .nav-link:active {
                background-color: white;
                color: black;
                box-shadow: 0 1px 1px 0px rgba(0, 0, 0, 0.5);
                text-shadow: 0 1px 0 transparent;
            }
            .nav-tabs > .nav-item {
                z-index: 2;
            }
            .nav-tabs {
                border-bottom-width: 0 !important;
            }
            .nav-tabs > .nav-item {
                position: relative
            }
            /* langer block unter erstem tab */
            .nav-tabs > .nav-item:first-of-type > .nav-link.active::after {
                content: "";
                position: absolute;
                width: 100%;
                height: 10px;
                left: -1px;
                bottom: -10px;
                z-index: 10;
                background-color: #fffefd;
                border-left: 1px solid #e2e5e8;
            }
            /* kleine blöcke VOR erstem tab */
            .nav-tabs > .nav-item:not(:first-of-type)::before {
                content: "";
                position: absolute;
                width: 10px;
                height: 10px;
                left: -5px;
                bottom: -10px;
                z-index: 11;
                background-color: #fffefd;
            }
            /* langer block unter nicht erstem tab */
            .nav-tabs > .nav-item:not(:first-of-type) > .nav-link.active::after {
                content: "";
                position: absolute;
                width: 100%;
                height: 10px;
                left: -1px;
                bottom: -10px;
                z-index: 10;
                background-color: #fffefd;
            }
            /* kleiner block HINTER letztem tab */
            .nav-tabs > .nav-item:last-of-type::after {
                content: "";
                position: absolute;
                width: 10px;
                height: 10px;
                right: -5px;
                bottom: -10px;
                z-index: 11;
                background-color: #fffefd;
            }
            /* */
            .nav-tabs > .nav-item > .nav-link.active {
                box-shadow: 0 2px 5px 0px #00000057;
                background-color: white;
                border-bottom-color: white;
                position: relative;
            }
            .nav-tabs > .nav-item > .nav-link.disabled {
                border: 1px solid var(--bs-gray-200, #e9ecef) !important;
            }
            .nav-tabs > .nav-item > a.nav-link:not(.disabled, .active):hover, .nav-tabs > .nav-item > a.nav-link:not(.disabled, .active):active,
            .nav-tabs > .nav-item > a.nav-link:not(.disabled, .active):focus {
                border: 1px solid var(--bs-gray-300, #dee2e6) !important;
                border-bottom: 1px solid transparent !important
            }
            table:not(.table-borderless) > thead > tr > th:first-of-type {
                border-top-left-radius: 2px;
            }
            table:not(.table-borderless) > thead > tr > th:last-of-type {
                border-top-right-radius: 2px;
            }
            table:not(.table-borderless) > thead > tr > th:not(.TintengefrorenerTiefenfrisch) {
                border-left: 1px solid var(--bs-gray-300, #dee2e6) !important;
            }
            table:not(.table-borderless) > thead > tr > th {
                border-top: 1px solid var(--bs-gray-300, #dee2e6) !important;
                border-bottom: 2px solid var(--bs-gray-300, #dee2e6) !important;
                background-color: #f7f7f7 !important
            }
            table:not(.table-borderless) > thead > tr > th:last-of-type {
                border-right: 1px solid var(--bs-gray-300, #dee2e6) !important;
            }
            table.dataTable:not(.table-borderless) > thead > tr > th:last-of-type {
                border-right: 1px solid var(--bs-gray-300, #dee2e6) !important
            }
            table.dataTable:not(.table-borderless) > tbody > tr > td:not(.fritz) {
                border-left: 1px solid var(--bs-gray-300, #dee2e6) !important
            }
            table.dataTable:not(.table-borderless) > tbody > tr:last-of-type > td {
                border-bottom: 1px solid var(--bs-gray-300, #dee2e6) !important
            }
            table.dataTable:not(.table-borderless) > tbody > tr:last-of-type > td:first-of-type {
                border-bottom-left-radius: 2px
            }
            table.dataTable:not(.table-borderless) > tbody > tr:last-of-type > td:last-of-type {
                border-bottom-right-radius: 2px
            }
            /* Normale Tabellen */
            table:not(.table-borderless, .dataTable) > tbody > tr > td:last-of-type {
                border-right: 1px solid var(--bs-gray-300, #dee2e6)
            }
            table:not(.table-borderless, .dataTable) > tbody > tr > td {
                border-bottom: 1px solid var(--bs-gray-300, #dee2e6);
                border-left: 1px solid var(--bs-gray-300, #dee2e6)
            }
            table.dataTable > thead .sorting::before, table.dataTable > thead .sorting_asc::before, 
            table.dataTable > thead .sorting_desc::before, table.dataTable > thead .sorting_asc_disabled::before, 
            table.dataTable > thead .sorting_desc_disabled::before,
            table.dataTable > thead .sorting::after, table.dataTable > thead .sorting_asc::after,
            table.dataTable > thead .sorting_desc::after, table.dataTable > thead .sorting_asc_disabled::after,
            table.dataTable > thead .sorting_desc_disabled::after {
                content: "" !important;
                right: auto !important
            }
            table.dataTable thead .sorting::after {
                position: absolute;
                width: 100%;
                height: 100%;
                right: 5px !important;
                top: 0 !important;
                opacity: 0.5 !important;
                background-repeat: no-repeat;
                background-position-x: right;
                background-position-y: center;
                background-size: 16px 16px;
                background-image: url("img/iconmonstr-sort-2.svg")
            }
            table.dataTable thead .sorting_desc::after {
                background-image: url("img/iconmonstr-sort-3.svg") !important
            }
            table.dataTable thead .sorting_asc::after {
                background-image: url("img/iconmonstr-sort-4.svg") !important
            }
            div.dataTables_scrollHeadInner {
                padding-right: 0 !important;
                width: 100% !important
            }
            table.dataTable:not(.table-borderless) > tbody > tr > td:only-of-type, table.dataTable:not(.table-borderless) > tbody > tr > td:last-of-type {
                border-right: 1px solid var(--bs-gray-300, #dee2e6);
            }
            table.dataTable > thead > tr > th {
                box-sizing: border-box;
            }
            /*
            div.dataTables_wrapper > .row:last-of-type {
                margin-top: 24px
            }*/
            footer a, footer a:hover {
                border-bottom: 1px dotted #ffffff;
                text-decoration: none;
                color: #ffffff;
            }
            .fritz {
                margin-right: calc(var(--bs-gutter-x) * 0.5);
                flex: 1 0 auto
            }
            /* Vorladen von Sortierungssymbolen in Tabellen */
            body::after {
                position: absolute;
                width: 0;
                height: 0;
                z-index: -1;
                overflow: hidden;
                content: url("img/iconmonstr-sort-2.svg") url("img/iconmonstr-sort-3.svg") url("img/iconmonstr-sort-4.svg")
            }
            .alert-primary.messageboxContainer {
                border-color: #b1cbf5
            }
            .alert-warning.messageboxContainer {
                border-color: #f2e7c4
            }
            .alert-danger.messageboxContainer {
                border-color: #e5babe
            }
            .alert-success.messageboxContainer {
                border-color: #b9dac1
            }
            .messageboxIcon {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0.714rem 0.357rem;
                align-self: stretch;
            }
            .messageboxIcon.primary {
                background-color: #b1cbf5;
                color: #437b95
            }
            .messageboxIcon.danger {
                background-color: #e5babe;
                color: #911
            }
            .messageboxIcon.success {
                background-color: #b9dac1;
                color: #508d50
            }
            .messageboxIcon.warning {
                background-color: #f2e7c4;
                color: #918130
            }
            .messageboxIcon > i {
                font-size: 1.5625rem
            }
            .messageboxText {
                padding: 0.5rem;
                margin: 0.5rem;
                width: 100%;
            }
            .messageboxContainer {
                display: flex;
                align-items: center;
                padding: 0;
                position: relative
            }
            .messageboxText button.close {
                margin: 0 0 auto auto;
            }
            .messageboxText ul {
                list-style-position: inside;
                margin: 0;
                padding: 0;
            }
            .table-container {
                flex: 1 0 auto;
                overflow-y: auto;
                width: 0;
            }
            .bg-gray-200 {
                background-color: var(--bs-gray-200, #e9ecef);
                font-weight: 600;
            }
            .time-picker {
                box-shadow: 0 0 3px 0 #0000006e;
                background-color: white;
                position: absolute;
                z-index: 1100
            }
            .time-picker::after {
                content: "";
                position: absolute;
                left: 5px;
                bottom: -6px;
                width: 0;
	            height: 0;
	            border-left: 6px solid transparent;
	            border-right: 6px solid transparent;
	            border-top: 6px solid white;
                z-index: 0;
                filter: drop-shadow(0px 0px 3px #0000006e)
            }
            /*
            .time-picker::after {
                content: "";
                position: absolute;
                left: 5px;
                bottom: -5px;
                width: 0;
	            height: 0;
	            border-left: 6px solid transparent;
	            border-right: 6px solid transparent;
	            border-top: 6px solid #0000006e;
                z-index: 9;
            }*/
            @font-face {
                font-family: "Font Awesome 5 Brands";
                font-style: normal;
                font-weight: 400;
                font-display: block;
                src: url("font/free-fa-brands-400.woff") format("woff")
            }
            @font-face {
                font-family: "Font Awesome 5 Free";
                font-style: normal;
                font-weight: 400;
                font-display: block;
                src: url("font/free-fa-regular-400.woff") format("woff")
            }
            @font-face {
                font-family: "Font Awesome 5 Pro";
                font-style: normal;
                font-weight: 400;
                font-display: block;
                src: url("font/free-fa-regular-400.woff") format("woff")
            }
            @font-face {
                font-family: "Font Awesome 5 Free";
                font-style: normal;
                font-weight: 900;
                font-display: block;
                src: url("font/free-fa-solid-900.woff") format("woff")
            }
            @font-face {
                font-family: "Font Awesome 5 Pro";
                font-style: normal;
                font-weight: 900;
                font-display: block;
                src: url("fonts/free-fa-solid-900.woff") format("woff")
            }
            @media only screen and (max-width: 600px) {
                .fritz {
                    margin-left: calc(var(--bs-gutter-x) * 0.5);
                }
                table.dataTable thead > tr > th {
                    font-weight: 600;
                }
                *:not(h1, h2, h3, h4, h5, h6, .messageboxIcon > i, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span, h1 > i, h2 > i, h3 > i, h4 > i, h5 > i, h6 > i) {
                    font-size: 14px !important;
                }
                main {
                    padding: 0 2%
                }
                #second-navbar, #mobile-navbar {
                    margin-right: 2%;
                }
                #first-navbar {
                    margin-left: 2%;
                }
                #mobile-navbar {
                    display: block;
                }
                #second-navbar {
                    display: none;
                }
                .formContainer {
                    flex-direction: column;
                }
                .formContainer > label + select:not(:last-child), .formContainer > label + input:not(:last-child), .formContainer > button:not(:last-child) {
                    margin-bottom: 0.5rem;
                }
                .dataTables_filter {
                    margin-top: 0.5rem;
                }
                .peter {
                    max-width: 40%;
                }
                .konrad {
                    margin-left: calc(0.5 * var(--bs-gutter-x));
                    margin-top: 0.25rem;
                }
            }
            @media only screen and (min-width: 600px) {
                table.dataTable thead > tr > th {
                    font-weight: 600;
                }
                *:not(h1, h2, h3, h4, h5, h6, .messageboxIcon > i, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span, h1 > i, h2 > i, h3 > i, h4 > i, h5 > i, h6 > i) {
                    font-size: 14px !important;
                }
                main {
                    padding: 0 2%
                }
                #second-navbar, #mobile-navbar {
                    margin-right: 2%;
                }
                #first-navbar {
                    margin-left: 2%;
                }
                #mobile-navbar {
                    display: block;
                }
                #second-navbar {
                    display: none;
                }
                .formContainer {
                    flex-direction: column;
                }
                .formContainer > label + select:not(:last-child), .formContainer > label + input:not(:last-child), .formContainer > button:not(:last-child) {
                    margin-bottom: 0.5rem;
                }
                .dataTables_filter {
                    margin-top: 0.5rem;
                }
                .peter {
                    max-width: 40%;
                }
                .konrad {
                    margin-left: calc(0.5 * var(--bs-gutter-x));
                    margin-top: 0.25rem;
                }
            }
            @media only screen and (min-width: 768px) {
                *:not(h1, h2, h3, h4, h5, h6, .messageboxIcon > i, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span, h1 > i, h2 > i, h3 > i, h4 > i, h5 > i, h6 > i) {
                    font-size: 14px !important;
                }
                main {
                    padding: 0 2%
                }
                .formContainer {
                    flex-direction: row;
                    align-content: center;
                    align-items: center;
                }
                .formContainer > label + select:not(:last-child), .formContainer > button:not(:last-child) {
                    margin-bottom: 0.5rem;
                }
                .row > label {
                    align-self: center;
                }
                table.dataTable thead > tr > th {
                    font-weight: 600;
                }
                main {
                    padding: 0 2%
                }
                #second-navbar, #mobile-navbar {
                    margin-right: 2%;
                }
                #first-navbar {
                    margin-left: 2%;
                }
                #mobile-navbar {
                    display: none;
                }
                #second-navbar {
                    display: block;
                }
                .peter {
                    max-width: unset;
                    margin-left: calc(-0.5 * var(--bs-gutter-x)) !important;
                }
                .konrad {
                    margin-left: 0;
                    margin-top: 0;
                }
            }
            @media only screen and (min-width: 992px) {
                .formContainer {
                    flex-direction: row;
                    align-content: center;
                    align-items: center;
                }
                .formContainer > * {
                    margin-top: 0;
                    margin-bottom: 0 !important;
                }
                .formContainer label:not(:first-of-type) {
                    margin-left: 1rem;
                }
                .formContainer button:not(:only-child) {
                    margin-left: 0.5rem;
                }
                #mobile-navbar {
                    display: none;
                }
                table.dataTable thead > tr > th {
                    font-weight: bold;
                }
                *:not(h1, h2, h3, h4, h5, h6, .messageboxIcon > i, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span, h1 > i, h2 > i, h3 > i, h4 > i, h5 > i, h6 > i) {
                    font-size: 16px !important;
                }
                main {
                    padding: 0 5%
                }
                #second-navbar, #mobile-navbar {
                    margin-right: 5%;
                }
                #first-navbar {
                    margin-left: 5%;
                }
                #mobile-navbar {
                    display: none;
                }
                #second-navbar {
                    display: block;
                }
                .peter {
                    max-width: unset;
                    margin-left: calc(-0.5 * var(--bs-gutter-x)) !important;
                }
                .konrad {
                    margin-left: 0;
                    margin-top: 0;
                }
            }
            @media only screen and (min-width: 1200px) {
                .formContainer {
                    flex-direction: row;
                    align-content: center;
                    align-items: center;
                }
                .formContainer > * {
                    margin-top: 0;
                    margin-bottom: 0;
                }
                .formContainer label:not(:first-of-type) {
                    margin-left: 1rem;
                }
                .formContainer button:not(:only-child) {
                    margin-left: 0.5rem;
                }
                table.dataTable thead > tr > th {
                    font-weight: bold;
                }
                *:not(h1, h2, h3, h4, h5, h6, .messageboxIcon > i, h1 > span, h2 > span, h3 > span, h4 > span, h5 > span, h6 > span, h1 > i, h2 > i, h3 > i, h4 > i, h5 > i, h6 > i) {
                    font-size: 16px !important;
                }
                main {
                    padding: 0 5%
                }
                #second-navbar, #mobile-navbar {
                    margin-right: 5%;
                }
                #first-navbar {
                    margin-left: 5%;
                }
                #mobile-navbar {
                    display: none;
                }
                #second-navbar {
                    display: block;
                }
                .peter {
                    max-width: unset;
                    margin-left: calc(-0.5 * var(--bs-gutter-x)) !important;
                }
                .konrad {
                    margin-left: 0;
                    margin-top: 0;
                }
            }
        </style>
        <script>
            // Dürfen Terminersteller ihre eigenen Termine löschen?
            // Wie kurzfristig können Termine geändert werden?
            // Ist eine Übersicht vergangener Termine nötig?
            // TODO: Wenn gerade eine Konferenz stattfindet, muss ein Timer laufen, der die Meldung über eine
            // laufende Konferenz ausblendet, wenn sie vorbei ist!

            // https://stackoverflow.com/a/49186677
            const getScrollParent = (node) => {
                const regex = /(auto|scroll)/;
                const parents = (_node, ps) => {
                if (_node.parentNode === null) { return ps; }
                    return parents(_node.parentNode, ps.concat([_node]));
                };

                const style = (_node, prop) => getComputedStyle(_node, null).getPropertyValue(prop);
                const overflow = _node => style(_node, 'overflow') + style(_node, 'overflow-y') + style(_node, 'overflow-x');
                const scroll = _node => regex.test(overflow(_node));

                /* eslint-disable consistent-return */
                const scrollParent = (_node) => {
                    if (!(_node instanceof HTMLElement || _node instanceof SVGElement)) {
                        return;
                    }

                    const ps = parents(_node.parentNode, []);

                    for (let i = 0; i < ps.length; i += 1) {
                        if (scroll(ps[i])) {
                            return ps[i];
                        }
                    }

                    return document.scrollingElement || document.documentElement;
                };

                return scrollParent(node);
                /* eslint-enable consistent-return */
            };
            var systemInfosEventSource = null;
            var viewportWidth = visualViewport["width"];
            var buildings = [];
            var rooms = [];
            var calendar = null;
            const rowGroupStrings = {
                admin: {
                    roles: {
                        1: "Benutzer",
                        2: "Moderator",
                        3: "Administrator"
                    }
                }
            }
            //const dataTables = {};
            const adminDataTables = {};
            const dataTablesLocalisation = {
                sEmptyTable: "Keine Daten vorhanden",
                sInfo: "_START_ bis _END_ von _TOTAL_ Einträgen",
                sInfoEmpty: "0 bis 0 von 0 Einträgen",
                sInfoFiltered: "(gefiltert aus _MAX_ Einträgen)",
                sInfoPostFix: "",
                sInfoThousands: ".",
                sLengthMenu: "_MENU_ Einträge anzeigen",
                sLoadingRecords: "Wird geladen...",
                sProcessing: "Bitte warten...",
                sSearch: "Suchen:",
                sZeroRecords: "Keine Einträge vorhanden.",
                oPaginate: {
                    sFirst: "Erste",
                    sPrevious: "Zurück",
                    sNext: "Nächste",
                    sLast: "Letzte"
                },
                oAria: {
                    sSortAscending: ": aktivieren, um Spalte aufsteigend zu sortieren",
                    sSortDescending: ": aktivieren, um Spalte absteigend zu sortieren"
                }
            }
            // Bescheuerte Filterung von bestimmten HTML-Elementen in Bootstraps "Popover" deaktivieren
            /*bootstrap["Popover"]["Default"]["allowList"]["button"] = ["onclick"];
            bootstrap["Popover"]["Default"]["allowList"]["table"] = [];
            bootstrap["Popover"]["Default"]["allowList"]["tbody"] = [];
            bootstrap["Popover"]["Default"]["allowList"]["tr"] = [];
            bootstrap["Popover"]["Default"]["allowList"]["td"] = [];*/
            /*const dataTablesOptions = {
                pastReservations: {
                    order: [0, "asc"],
                    language: dataTablesLocalisation,
                    columns: [
                        {
                            name: "id",
                            data: "id",
                            visible: false
                        },
                        {
                            name: "room",
                            data: "room",
                        },
                        {
                            name: "time",
                            data: "time",
                        },
                        {
                            name: "booker",
                            data: "booker",
                        },
                        {
                            name: "description",
                            data: "description",
                        }
                    ],
                    ajax: {
                        url: "dataTables.php",
                        type: "GET",
                        data: {
                            type: "pastReservations"
                        },
                        dataSrc: function(response) {
                            return response["data"];
                        }
                    },
                    drawCallback: function(settings) {
                        $("#pastReservationsAdminTable").parent().addClass("table-container");
                    }
                }
            };
            */
            const dataTablesAdminOptions = {
                roles: {
                    order: [0, "asc"],
                    language: dataTablesLocalisation,
                    columns: [
                        {
                            name: "id",
                            data: "id",
                            width: "15%"
                        },
                        {
                            name: "group",
                            data: "group",
                            visible: false
                        },
                        {
                            name: "name",
                            data: "name",
                        },
                        {
                            name: "options",
                            data: function(row, type, set, meta) {
                                return "<div class='d-flex flex-wrap' style='gap: 5px'><button type='button' class='btn btn-sm btn-primary' style='width: 32px'><i class='fas fa-pen'></i></button><button type='button' class='btn btn-sm btn-danger' style='width: 32px' onclick='confirmUserDeletion(" + row["id"] + ")'><i class='fas fa-times'></i></button></div>";
                            },
                            sorting: false,
                            width: "20%"
                        }
                    ],
                    ajax: {
                        url: "dataTables.php",
                        type: "POST",
                        data: {
                            type: "roles"
                        },
                        dataSrc: function(response) {
                            return response["data"];
                        }
                    },
                    drawCallback: function(settings) {
                        $("#rolesAdminTable").parent().addClass("table-container");
                    }
                },
                buildings: {
                    order: [0, "asc"],
                    language: dataTablesLocalisation,
                    columns: [
                        {
                            name: "id",
                            data: "id",
                            width: "15%"
                        },
                        {
                            name: "name",
                            data: "name",
                        },
                        {
                            name: "description",
                            data: "description",
                        },
                        {
                            name: "options",
                            data: function(row, type, set, meta) {
                                return "<div class='d-flex flex-wrap' style='gap: 5px'><button type='button' class='btn btn-sm btn-primary' style='width: 32px'><i class='fas fa-pen'></i></button><button type='button' class='btn btn-sm btn-danger' style='width: 32px' onclick='confirmBuildingDeletion(" + row["id"] + "," + row["name"] + ")'><i class='fas fa-times'></i></button></div>";
                            },
                            sorting: false,
                            width: "20%"
                        }
                    ],
                    ajax: {
                        url: "dataTables.php",
                        type: "POST",
                        //contentType: "application/x-www-form-urlencoded",
                        contentType: "application/json",
                        data: function(data, settings) {
                            data["type"] = "buildings";
                            return JSON.stringify(data);
                            //data = "type=buildings";
                            //return encodeURIComponent(data);
                        },
                        dataSrc: function(response) {
                            return response["data"];
                        }
                    },
                    drawCallback: function(settings) {
                        $("#buildingsAdminTable").parent().addClass("table-container");
                    }
                },
                rooms: {
                    order: [0, "asc"],
                    language: dataTablesLocalisation,
                    columns: [
                        {
                            name: "id",
                            data: "id",
                            width: "15%"
                        },
                        {
                            name: "building",
                            data: "building",
                            visible: false
                        },
                        {
                            name: "name",
                            data: "name",
                        },
                        {
                            name: "description",
                            data: "description",
                        },
                        {
                            name: "options",
                            data: function(row, type, set, meta) {
                                return "<div class='d-flex flex-wrap' style='gap: 5px'><button type='button' class='btn btn-sm btn-primary' style='width: 32px'><i class='fas fa-pen'></i></button><button type='button' class='btn btn-sm btn-danger' style='width: 32px' onclick='confirmRoomDeletion(" + row["id"] + "," + row["building"] + ")'><i class='fas fa-times'></i></button></div>";
                            },
                            sorting: false,
                            width: "20%"
                        }
                    ],
                    ajax: {
                        url: "dataTables.php",
                        type: "POST",
                        data: {
                            type: "rooms"
                        },
                        dataSrc: function(response) {
                            return response["data"];
                        }
                    },
                    drawCallback: function(settings) {
                        $("#roomsAdminTable").parent().addClass("table-container");
                    }
                }
            }
            const dateTimePickerIcons = {
                time: "far fa-clock",
                date: "fas fa-calendar",
                up: "fas fa-chevron-up",
                down: "fas fa-chevron-down",
                previous: "fas fa-chevron-left",
                next: "fas fa-chevron-right",
                today: "fas fa-check",
                clear: "fas fa-trash-alt",
                close: "fas fa-times"
            };
            function login(wtf) {
                if ($("#mainModal").hasClass("show") && $("#mainModal").attr("data-name") == "login") {
                    if ($("#body-overlay").length == 0) {
                        $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                    }
                    if ($(wtf).find("[data-processing='true']").length == 0) {
                        $(wtf).prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                    }
                    $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                    $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                    $("#mainModal .modal-body > .alert").remove();
                    $.post("lol", {
                        username: $("#username").val(),
                        password: $("#password").val()
                    }).done(function(response) {
                        //cookies setzen
                        //anmeldeknopf durch abmeldeknopf ersetzen
                        //userRole auf moderator/administrator/user setzen
                    }).fail(function(response) {
                        $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                    }).always(function() {
                        $(wtf).find("[data-processing='true']").remove();
                        $(wtf).removeAttr("disabled");
                        $("#body-overlay").remove();
                        $("#mainModal .modal-footer > button").removeAttr("disabled");
                        $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                    });
                }
            }
            function logout(wtf) {
                //cookies löschen
                //abmeldeknopf durch anmeldeknopf ersetzen (auch in mobiler ansicht)
            }
            function getBuildings() {
                $.post({
                    url:  "dataTables.php",
                    contentType: "application/js",
                    data: JSON.stringify({type: "buildings"})
                }).done(function(response) {
                    let data = JSON.parse(response);
                    console.log(data);
                    Object.assign(buildings, data);
                }).fail(function(response) {
                    $("#calendar").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                }).always(function() {
                });
            }
            function updateSystemInfos() {
                if (systemInfosEventSource === null || systemInfosEventSource["readyState"] == 2) {
                    systemInfosEventSource = new EventSource("sse_test.php");
                    systemInfosEventSource.onmessage = function(event) {
                        if ($("#mainModal").attr("data-name") == "systemInfos") {
                            let data = JSON.parse(event["data"]);
                            let statsText = "";
                            if (data.hasOwnProperty("osname")) {
                                statsText += "<tr><td class='align-top'>Kernelversion</td><td>" + data["osname"] + "</td></tr>";
                            }
                            if (data.hasOwnProperty("arch")) {
                                statsText += "<tr><td class='align-top'>Architektur</td><td>" + data["arch"] + "</td></tr>";
                            }
                            if (data.hasOwnProperty("cpus")) {
                                statsText += "<tr><td class='align-top'>CPU</td><td>" + data["cpus"][0]["model"];
                                for (let [index, cpu] of data["cpus"].entries()) {
                                    statsText += "<div>CPU #" + index + ":<div class='ps-3'>Takt: " + cpu["speed"] + "MHz</div></div>";
                                }
                                statsText += "</td></tr>";
                            }
                            if (data.hasOwnProperty("freememory") && data.hasOwnProperty("totalmemory")) {
                                statsText += "<tr><td class='align-top'>Speicher</td><td>" + data["freememory"] + " MB/" + data["totalmemory"] + " MB (" + Math.floor(((data["freememory"] / data["totalmemory"]) *100)) + " %)</td></tr>";
                            }
                            if (data.hasOwnProperty("hostname")) {
                                statsText += "<tr><td class='align-top'>Host</td><td>" + data["hostname"] + "</td></tr>";
                            }
                            if (data.hasOwnProperty("uptime")) {
                                statsText += "<tr><td class='align-top'>Laufzeit</td><td>" + data["uptime"].duration() + "</td></tr>";
                            }
                            $("#systemInfosTable").html(statsText);
                        }
                        else {
                            systemInfosEventSource.close();
                            systemInfosEventSource = null;
                        }
                    };
                }
            }
            function readjustTables() {
                let collapses = ["#collapse-rooms", "#collapse-roles"];
                let element = null;
                let tableName = null;
                for (collapse of collapses) {
                    element = $("a[href='" + collapse + "']");
                    tableName = $(element).attr("data-admin-table");
                    if ($(element).attr("aria-expanded") === "true") {
                        adminDataTables[tableName].columns.adjust().draw();
                    }
                }
            }
            /*
            function hidePopOver(element) {
                bootstrap.Popover.getInstance($(element).parents(".popover")[0]).hide();
            }
            */
            async function confirmUserDeletion(user, room = null, building = null) {
                let prompt = new Promise(function(resolve) {
                    confirmation({
                        title: "Benutzer entfernen bestätigen",
                        content: "Soll der Benutzer &quot;"  + user + "&quot; (Gebäude &quot;" + building + "&quot;) wirklich entfernt werden?"
                    },
                    resolve);
                });
                let result = await prompt;
                if (result) {
                    if ($("#body-overlay").length == 0) {
                        $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                    }
                    if ($("#confirmationButton").find("[data-processing='true']").length == 0) {
                        $("#confirmationButton").prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                    }
                    $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                    $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                    $("#mainModal .modal-body > .alert").remove();
                    let data = {
                        user: user,
                        room: room,
                        building: building
                    }
                    $.post("lol", {
                        _token: authToken,
                        data: JSON.stringify(data)
                    }).done(function(response) {
                        bootstrap.Modal.getInstance($("#mainModal")[0]).hide();
                    }).fail(function(response) {
                        $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                    }).always(function() {
                        $("#confirmationButton").find("[data-processing='true']").remove();
                        $("#body-overlay").remove();
                        $("#mainModal .modal-footer > button").removeAttr("disabled");
                        $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                    });
                }
            }
            function confirmRoomDeletion(room, building) {
                let prompt = new Promise(function(resolve) {
                    confirmation({
                        title: "Raum entfernen bestätigen",
                        content: "Soll der Raum &quot;"  + room + "&quot; (Gebäude &quot;" + building + "&quot;) wirklich entfernt werden?"
                    },
                    resolve);
                });
                let result = await prompt;
                if (result) {
                    if ($("#body-overlay").length == 0) {
                        $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                    }
                    if ($("#confirmationButton").find("[data-processing='true']").length == 0) {
                        $("#confirmationButton").prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                    }
                    $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                    $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                    $("#mainModal .modal-body > .alert").remove();
                    let data = {
                        room: room,
                        building: building
                    }
                    $.post("lol", {
                        _token: authToken,
                        data: JSON.stringify(data)
                    }).done(function(response) {
                        bootstrap.Modal.getInstance($("#mainModal")[0]).hide();
                    }).fail(function(response) {
                        $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                    }).always(function() {
                        $("#confirmationButton").find("[data-processing='true']").remove();
                        $("#body-overlay").remove();
                        $("#mainModal .modal-footer > button").removeAttr("disabled");
                        $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                    });
                }
            }
            function confirmation(options = {}, resolve) {
                let data = {
                    modal: {
                        name: "confirmation"
                    },
                    title: {
                        text: (options.hasOwnProperty("title") ? options["title"] : "Bestätigung")
                    },
                    content: {
                        text: (options.hasOwnProperty("content") ? options["content"] : "Soll diese Aktion wirklich ausgeführt werden?")
                    },
                    footer: {
                        buttons: {
                            default: {
                                text: "Nein",
                                class: "btn-primary"
                            },
                            custom: [
                                {
                                    text: "Ja",
                                    class: "btn-danger",
                                    attributes: {
                                        id: "confirmationButton"
                                    },
                                    actions: [
                                        {
                                            click: [
                                                {
                                                    function: function() {
                                                        resolve(true);
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                };
                Modal.create(data);
            }
            class Alert {
                static create(type, message, closeable = true, classes = "") {
                    type = type.toLowerCase();
                    let icons = {
                        danger: "fas fa-exclamation-circle",
                        primary: "fas fa-info-circle",
                        warning: "fas fa-exclamation-triangle",
                        success: "fas fa-check-circle"
                    };
                    if (!["primary", "success", "danger", "warning"].includes(type)) {
                        type = "primary";
                    }
                    return "<div class='" + (closeable ? "alert-dismissible " : "") + "alert alert-" + type + " messageboxContainer " + classes + "' role='alert'><div class='messageboxIcon " + type + "'><i class='" + icons[type] + "'></i></div><div class='messageboxText'>" + message + (closeable ? "</div><button type='button' class='btn-close position-static align-self-start' data-bs-dismiss='alert' aria-label='Schließen'></button>" : "") + "</div>";
                }
            }
            // Wird verwendet, um Funktionen innerhalb von Objekten auszuführen
            function achso(callback, args = null) {
                callback.apply(this, args);
            }
            class Modal {
                /*
                data: {
                    modal: {
                        size?: sm|default|lg|xl|fullscreen,
                        static?: bool,
                        name: string,
                        events?: [
                            {
                                hide: {
                                    function: function() { },
                                    args?: []
                                }
                            }
                        ]
                    },
                    title: {
                        text: string
                    },
                    content: {
                        text: string
                        options?: {
                            scroll?: bool,
                            align?: left|center|right
                        }
                    },
                    footer?: {
                        buttons?: {
                            default?: {
                                text: string,
                                class?: string,
                                display?: bool,
                                attributes?: {
                                    attribute: value
                                }
                            }
                            // Eigene
                            custom?: [
                                {
                                    text: string,
                                    class?: string,
                                    attributes?: {},
                                    actions: [{
                                        click: [
                                            {
                                                function: (string|function() {}),
                                                args?: []
                                            }
                                        ]
                                    }]
                                }]
                            }
                        }
                    }
                }
                */
                static create(data = {}) {
                    if ($("#mainModal").hasClass("show")) {
                        $("#mainModal").hide();
                    }
                    $("#mainModal > div:first-of-type").removeClass("modal-sm modal-lg modal-xl modal-fullscreen modal-dialog-scrollable modal-dialog-centered");
                    $("#mainModal").removeAttr("data-bs-backdrop data-bs-keyboard");
                    $("#mainModal .modal-header > h4").empty();
                    $("#mainModal .modal-body").empty();
                    $("#mainModal .modal-footer").empty();
                    if (data.hasOwnProperty("modal") && data["modal"].hasOwnProperty("name") && !["undefined", "", undefined, null].includes(data["title"]["text"])) {
                        $("#mainModal").attr("data-name", data["modal"]["name"]);
                        if (data["modal"].hasOwnProperty("size") && ["sm", "lg", "xl", "fullscreen"].includes(data["modal"]["size"])) {
                            $("#mainModal > div:first-of-type").addClass("modal-" + data["modal"]["size"]);
                        }
                        if (data["modal"].hasOwnProperty("static") && data["modal"]["static"]) {
                            $("#mainModal").attr({"data-bs-backdrop":"static", "data-bs-keyboard":"false"});
                        }
                        if (data.hasOwnProperty("title")) {
                            if (data["title"].hasOwnProperty("text") && !["undefined", "", undefined, null].includes(data["title"]["text"])) {
                                $("#mainModal .modal-header > h4").html(data["title"]["text"]);
                            }
                        }
                        if (data.hasOwnProperty("content")) {
                            if (data["content"].hasOwnProperty("options")) {
                                if (data["content"]["options"].hasOwnProperty("scroll") && data["content"]["options"]["scroll"]) {
                                    $("#mainModal > div:first-of-type").addClass("modal-dialog-scrollable");
                                }
                            }
                            if (data["content"].hasOwnProperty("text") && !["undefined", "", undefined, null].includes(data["content"]["text"])) {
                                $("#mainModal .modal-body").html(data["content"]["text"]);
                            }
                        }
                        if (data.hasOwnProperty("footer")) {
                            if (data["footer"].hasOwnProperty("buttons")) {
                                if (data["footer"]["buttons"].hasOwnProperty("default")) {
                                    let defaultButtonText = "";
                                    let defaultButtonClass = "";
                                    let defaultButton = $("<button type='button' data-bs-dismiss='modal' class='btn'>");
                                    if ((data["footer"]["buttons"].hasOwnProperty("display") && data["footer"]["buttons"]["display"]) || !data["footer"]["buttons"].hasOwnProperty("display")) {
                                        if (data["footer"]["buttons"]["default"].hasOwnProperty("text") && !["undefined", "", undefined, null].includes(data["footer"]["buttons"]["default"]["text"])) {
                                            defaultButtonText = data["footer"]["buttons"]["default"]["text"];
                                        }
                                        else {
                                            defaultButtonText = "Schließen";
                                        }
                                    }
                                    if (data["footer"]["buttons"]["default"].hasOwnProperty("class") && !["undefined", "", undefined, null].includes(data["footer"]["buttons"]["default"]["class"])) {
                                        defaultButtonClass = data["footer"]["buttons"]["default"]["class"];
                                    }
                                    else {
                                        defaultButtonClass = "btn-secondary";
                                    }
                                    $(defaultButton).addClass(defaultButtonClass).html(defaultButtonText);
                                    if (data["footer"]["buttons"]["default"].hasOwnProperty("attributes")) {
                                        let attributes = Object.getOwnPropertyNames(data["footer"]["buttons"]["default"]["attributes"]);
                                        for (let attribute of attributes) {
                                            $(defaultButton).attr(attribute, data["footer"]["buttons"]["default"]["attributes"][attribute]);
                                        }
                                    }
                                    $("#mainModal .modal-footer").append(defaultButton);
                                }
                                else {
                                    $("#mainModal .modal-footer").append("<button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Schließen</button>");
                                }
                                if (data["footer"]["buttons"].hasOwnProperty("custom")) {
                                    let customButtons = data["footer"]["buttons"]["custom"];
                                    for (let customButton of customButtons) {
                                        if (customButton.hasOwnProperty("text") && !["undefined", "", undefined, null].includes(customButton["text"]) /*&& customButton.hasOwnProperty("actions") && !["undefined", undefined, null].includes(customButton["actions"])*/) {
                                            let currentButton = $("<button type='button' class='btn'>" + customButton["text"] + "</button>");
                                            if (customButton.hasOwnProperty("class") && !["undefined", "", undefined, null].includes(customButton["class"])) {
                                                $(currentButton).addClass(customButton["class"]);
                                            }
                                            else {
                                                $(currentButton).addClass("btn-primary");
                                            }
                                            for (let action of customButton["actions"]) {
                                                let events = Object.getOwnPropertyNames(action);
                                                for (event of events) {
                                                    for (let func of action[event]) {
                                                        if (func.hasOwnProperty("args") && typeof(func["function"]) === "object") {
                                                            $(currentButton).on(event, function() {
                                                                achso(func["function"], func["args"]);
                                                            });
                                                        }
                                                        else if (typeof(func["function"]) === "function") {
                                                            $(currentButton).on(event, function() {
                                                                achso(func["function"]);
                                                            });
                                                        }
                                                    }
                                                }
                                            }
                                            if (customButton.hasOwnProperty("attributes")) {
                                                let attributes = Object.getOwnPropertyNames(customButton["attributes"]);
                                                for (let attribute of attributes) {
                                                    $(currentButton).attr(attribute, customButton["attributes"][attribute]);
                                                }
                                            }
                                            $("#mainModal .modal-footer").prepend(currentButton);
                                        }
                                    }
                                }
                            }
                            else {
                                $("#mainModal .modal-footer").append("<button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Schließen</button>");
                            }
                        }
                        else {
                            $("#mainModal .modal-footer").append("<button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Schließen</button>");
                        }
                        if (data["modal"].hasOwnProperty("events")) {
                            let eventNames = {hide: "hide.bs.modal", hidden: "hidden.bs.modal", show: "show.bs.modal", shown: "shown.bs.modal", hidePrevented: "hidePrevented.bs.modal"};
                            let events_ = Object.getOwnPropertyNames(data["modal"]["events"]);
                            for (let event_ of events_) {
                                if (eventNames.hasOwnProperty(event_)) {
                                    if (data["modal"]["events"][event_].hasOwnProperty("args") && typeof(data["modal"]["events"][event_]["function"]) === "object") {
                                        $("#mainModal").one(eventNames[event_], function() {
                                            achso(data["modal"]["events"][event_]["function"], data["modal"]["events"][event_]["args"]);
                                        });
                                    }
                                    else if (typeof(data["modal"]["events"][event_]["function"]) === "function") {
                                        $("#mainModal").one(eventNames[event_], function() {
                                            achso(data["modal"]["events"][event_]["function"]);
                                        });
                                    }
                                }
                            }
                        }
                        new bootstrap.Modal($("#mainModal")).show();
                    }
                    else {
                        alert("Fehler: Es muss ein gültiger Name für den Dialog angegeben werden.");
                    }
                }
            }
            /*
            class TimePicker {
                constructor(element) {
                    if ($(element).prop("tagName") === "INPUT" && (typeof($(element).attr("data-time-picker-id")) !== "undefined" && timePickers.findIndex(key => key["id"] === Number.parseInt($(element).attr("data-time-picker-id"))) <= 0) || (typeof($(element).attr("data-time-picker-id")) === "undefined")) {
                        this.id = new Date().getMilliseconds() + Math.floor(Math.random(0, viewportWidth));
                        this.element = element;
                        this.hours = 0;
                        this.minutes = 0;
                        $(element).attr("data-time-picker-id", this.id);
                        let picker = "<div class='d-flex rounded-2 p-1 time-picker' data-time-picker-id='" + this.id +  "'>";
                        picker += "<div class='d-flex flex-column'><button class='btn btn-secondary p-0' style='height: 2rem; width: 2rem' data-action='increaseHour' data-time-picker-parent='" + this.id + "'><i class='fas fa-chevron-up'></i></button><h3 class='m-0 text-center' data-unit='hours'>00</h3><button class='btn btn-secondary p-0' style='height: 2rem; width: 2rem' data-action='decreaseHour' data-time-picker-parent='" + this.id + "'><i class='fas fa-chevron-down'></i></button></div>";
                        picker += "<div class='d-flex align-items-center align-content-center'><div style='height: 2rem; visibility: hidden'></div><h3 class='m-0 text-center'>:</h3><div style='height: 2rem; visibility: hidden'></div></div>";
                        picker += "<div class='d-flex flex-column'><button class='btn btn-secondary p-0' style='height: 2rem; width: 2rem' data-action='increaseMinute' data-time-picker-parent='" + this.id + "'><i class='fas fa-chevron-up'></i></button><h3 class='m-0 text-center' data-unit='minutes'>00</h3><button class='btn btn-secondary p-0' style='height: 2rem; width: 2rem' data-action='decreaseMinute' data-time-picker-parent='" + this.id + "'><i class='fas fa-chevron-down'></i></button></div></div>";
                        this.picker = $(picker);
                        this.picker.find("[data-action='increaseHour']").click(function() {
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-parent")));
                            if (index >= 0) {
                                $(timePickers[index].increaseHour());
                            }
                        });
                        this.picker.find("[data-action='decreaseHour']").click(function() {
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-parent")));
                            if (index >= 0) {
                                $(timePickers[index].decreaseHour());
                            }
                        });
                        this.picker.find("[data-action='increaseMinute']").click(function() {
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-parent")));
                            if (index >= 0) {
                                $(timePickers[index].increaseMinute());
                            }
                        });
                        this.picker.find("[data-action='decreaseMinute']").click(function() {
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-parent")));
                            if (index >= 0) {
                                $(timePickers[index].decreaseMinute());
                            }
                        });
                        timePickers.push(this);
                        $("body").append($(this.picker).on("mousedown", false));
                        // Referenz auf this, da sich this immer auf die aktuelle Funktion bezieht
                        let that = this;
                        $(element).focus(function() {
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-id")));
                            if (index >= 0) {
                                console.log(getScrollParent(element));
                                $(getScrollParent(element)).scroll({index: index}, that.scroll);
                                let position = $(this).offset();
                                $(timePickers[index]["picker"]).removeClass("d-none").addClass("d-flex").css({"top": position["top"] - $(timePickers[index]["picker"]).outerHeight() + "px", left: position["left"] + "px"});
                                if (timePickers[index].hasOwnProperty("hours") && Number.isSafeInteger(timePickers[index]["hours"]) && timePickers[index].hasOwnProperty("minutes") && Number.isSafeInteger(timePickers[index]["minutes"])) {
                                    $(timePickers[index]["picker"]).find("h3[data-unit='hours']").html((timePickers[index]["hours"] <= 9 ? "0" : "") + timePickers[index]["hours"].toString());
                                    $(timePickers[index]["picker"]).find("h3[data-unit='minutes']").html((timePickers[index]["minutes"] <= 9 ? "0" : "") + timePickers[index]["minutes"].toString());
                                    $(timePickers[index]["element"]).val((timePickers[index]["hours"] <= 9 ? "0" : "") + timePickers[index]["hours"].toString() + ":" + (timePickers[index]["minutes"] <= 9 ? "0" : "") + timePickers[index]["minutes"].toString());
                                }
                                else {
                                    $(timePickers[index]["element"]).val("00:00");
                                }
                            }
                        }).blur(function() {
                            $("#mainModal").off("scroll", that.scroll);
                            let index = timePickers.findIndex(key => key["id"] === Number.parseInt($(this).attr("data-time-picker-id")));
                            if (index >= 0) {
                                //$(timePickers[index]["picker"]).removeClass("d-flex").addClass("d-none");
                            }
                        });
                    }
                }
                show() {
                }
                hide() {
                }
                scroll(event) {
                    let position = $(timePickers[event["data"]["index"]]["element"]).offset();
                    console.log(position);
                    $(timePickers[event["data"]["index"]]["picker"]).css({"top": position["top"] - $(timePickers[event["data"]["index"]]["picker"]).outerHeight() + "px", left: position["left"] + "px"});
                }
                increaseHour() {
                    if (this.hasOwnProperty("hours") && Number.isInteger(this.hours)) {
                        if (this.hours >= 0 && this.hours <= 22) {
                            this.hours++;
                        }
                        else {
                            this.hours = 0;
                        }
                    }
                    else {
                        this.hours = 0;
                    }
                    $(this.picker).find("h3[data-unit='hours']").html((this.hours <= 9 ? "0" : "") + this.hours.toString());
                    $(this.element).val((this.hours <= 9 ? "0" : "") + this.hours.toString() + ":" + (this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                }
                decreaseHour() {
                    if (this.hasOwnProperty("hours") && Number.isInteger(this.hours)) {
                        if (this.hours >= 1 && this.hours <= 23) {
                            this.hours--;
                        }
                        else {
                            this.hours = 23;
                        }
                    }
                    else {
                        this.hours = 0;
                    }
                    $(this.picker).find("h3[data-unit='hours']").html((this.hours <= 9 ? "0" : "") + this.hours.toString());
                    $(this.element).val((this.hours <= 9 ? "0" : "") + this.hours.toString() + ":" + (this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                }
                increaseMinute() {
                    if (this.hasOwnProperty("minutes") && Number.isInteger(this.minutes)) {
                        if (this.minutes >= 0 && this.minutes <= 58) {
                            this.minutes++;
                        }
                        else {
                            this.minutes = 0;
                        }
                    }
                    else {
                        this.minutes = 0;
                    }
                    $(this.picker).find("h3[data-unit='minutes']").html((this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                    $(this.element).val((this.hours <= 9 ? "0" : "") + this.hours.toString() + ":" + (this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                }
                decreaseMinute() {
                    if (this.hasOwnProperty("minutes") && Number.isInteger(this.minutes)) {
                        if (this.minutes >= 1 && this.minutes <= 59) {
                            this.minutes--;
                        }
                        else {
                            this.minutes = 59;
                        }
                    }
                    else {
                        this.minutes = 0;
                    }
                    $(this.picker).find("h3[data-unit='minutes']").html((this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                    $(this.element).val((this.hours <= 9 ? "0" : "") + this.hours.toString() + ":" + (this.minutes <= 9 ? "0" : "") + this.minutes.toString());
                }
            }
            */
            function checkHours(element) {
                let value = Number.parseInt($(element).val());
                if (Number.isSafeInteger(value)) {
                    if (value <= -1 || value >= 24) {
                        $(element).val("00");
                    }
                }
                else {
                    $(element).val("00");
                }
            }
            function checkMinutes(element) {
                let value = Number.parseInt($(element).val());
                if (Number.isSafeInteger(value)) {
                    if (value <= -1 || value >= 60) {
                        $(element).val("00");
                    }
                }
                else {
                    $(element).val("00");
                }
            }
            function createNewRoom(wtf = null) {
                let content = "<form>";
                content += "<div class='row'><label class='col-md-3' for='newRoomBuildingSelect'>Gebäude:</label>";
                content += "<select class='col-md-9 w-auto form-select fritz' id='newRoomBuildingSelect'>";
                if (buildings.length >= 1) {
                    for (building of buildings) {
                        content += "<option value='" + building["id"] + "'" + (wtf !== null && Number.parseInt(wtf) === building["id"] ? "selected=selected" : "") + ">" + building["name"] + "</option>";
                    }
                }
                content += "</select></div>";
                content += "<div class='row mt-3'><label class='col-md-3' for='newRoomRoomName'>Name:</label>";
                content += "<input type='text' class='col-md-9 w-auto form-control fritz' id='newRoomName'></div>";
                content += "<div class='row mt-3'><label class='col-md-3' for='newRoomDescription'>Beschreibung:</label>";
                content += "<input type='text' class='col-md-9 w-auto form-control fritz' id='newRoomDescription'></div>";
                content += "</div></form>";
                let data = {
                    modal: {
                        name: "createNewRoom",
                        static: true
                    },
                    title: {
                        text: "Neuen Raum erstellen"
                    },
                    content: {
                        text: content
                    },
                    footer: {
                        buttons: {
                            default: {
                                text: "Abbrechen",
                                class: "btn-danger"
                            },
                            custom: [
                                {
                                    text: "Speichern",
                                    class: "btn-primary",
                                    attributes: {
                                        id: "saveNewRoomButton"
                                    },
                                    actions: [
                                        {
                                            click: [
                                                {
                                                    function: function() {
                                                        if ($("#body-overlay").length == 0) {
                                                            $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                                                        }
                                                        if ($("#saveNewRoomButton").find("[data-processing='true']").length == 0) {
                                                            $("#saveNewRoomButton").prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                                                        }
                                                        $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                                                        $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                                                        $("#mainModal .modal-body > .alert").remove();
                                                        let data = {
                                                            building: $("#newRoomBuildingSelect").val(),
                                                            name: $("#newRoomName").val(),
                                                            description: $("#newRoomDescription").val()
                                                        }
                                                        $.post("lol", {
                                                            _token: authToken,
                                                            data: JSON.stringify(data)
                                                        }).done(function(response) {
                                                        }).fail(function(response) {
                                                            $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                                                        }).always(function() {
                                                            $("#saveNewRoomButton").find("[data-processing='true']").remove();
                                                            $("#saveNewRoomButton").removeAttr("disabled");
                                                            $("#body-overlay").remove();
                                                            $("#mainModal .modal-footer > button").removeAttr("disabled");
                                                            $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                                                        });
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                };
                Modal.create(data);
            }
            function toggleNewReservationTimes(element) {
                if ($("#mainModal").attr("data-name") === "newReservation") {
                    if ($(element).prop("checked")) {
                        $("#newReservationTimeToHours").attr("disabled", "disabled");
                        $("#newReservationTimeToMinutes").attr("disabled", "disabled");
                    }
                    else {
                        $("#newReservationTimeToHours").removeAttr("disabled");
                        $("#newReservationTimeToMinutes").removeAttr("disabled");
                    }
                }
            }
            function createNewUser() {
                // Moderatoren nur für einzelne Gebäude?
                // Supermoderator für alle Gebäude, der wie lokaler Moderator Termine stornieren/bearbeiten kann?
                let content = "<form>";
                content += "<div class='row'><label class='col-md-3' for='newUserRoleSelect'>Rolle:</label>";
                content += "<select class='col-md-9 w-auto form-select fritz' id='newUserRoleSelect'>";
                content += "<option value='1'>Benutzer</option><option value='2'>Moderator</option><option value='3'>Supermoderator</option><option value='4'>Administrator</option></select></div>";
                content += "<div class='row'><article class='col-md-9 offset-md-3 fritz ps-0 text-break' style='font-size: smaller !important; color: var(--bs-gray-700, #495057)' id='newUserRoleDescrption'></article></div>";
                content += "<div class='row mt-3'><label class='col-md-3' for='newUserBuildingSelect'>Gebäude:</label>";
                content += "<select class='col-md-9 w-auto form-select fritz' id='newRoomBuildingSelect'>";
                if (buildings.length >= 1) {
                    for (building of buildings) {
                        content += "<option value='" + building["id"] + "'>" + building["name"] + "</option>";
                    }
                }
                content += "</select></div>";
                content += "<div class='row mt-3'><label class='col-md-3' for='newUserName'>Benutzername:</label>";
                content += "<input type='text' class='col-md-9 w-auto form-control fritz' id='newUserName'></div>";
                content += "<div class='row mt-3'><label class='col-md-3' for='newUserRealName'>Voller Name:</label>";
                content += "<input type='text' class='col-md-9 w-auto form-control fritz' id='newUserRealName'></div>";
                content += "</div></form>";
                let data = {
                    modal: {
                        name: "createNewUser",
                        static: true
                    },
                    title: {
                        text: "Neuen Benutzer erstellen"
                    },
                    content: {
                        text: content
                    },
                    footer: {
                        buttons: {
                            default: {
                                text: "Abbrechen",
                                class: "btn-danger"
                            },
                            custom: [
                                {
                                    text: "Speichern",
                                    class: "btn-primary",
                                    attributes: {
                                        id: "saveNewUserButton"
                                    },
                                    actions: [
                                        {
                                            click: [
                                                {
                                                    function: function() {
                                                        if ($("#body-overlay").length == 0) {
                                                            $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                                                        }
                                                        if ($("#saveNewUserButton").find("[data-processing='true']").length == 0) {
                                                            $("#saveNewUserButton").prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                                                        }
                                                        $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                                                        $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                                                        $("#mainModal .modal-body > .alert").remove();
                                                        let data = {
                                                            building: $("#newRoomBuildingSelect").val(),
                                                            name: $("#newRoomName").val(),
                                                            description: $("#newRoomDescription").val()
                                                        }
                                                        $.post("lol", {
                                                            _token: authToken,
                                                            data: JSON.stringify(data)
                                                        }).done(function(response) {
                                                        }).fail(function(response) {
                                                            $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                                                        }).always(function() {
                                                            $("#saveNewUserButton").find("[data-processing='true']").remove();
                                                            $("#saveNewUserButton").removeAttr("disabled");
                                                            $("#body-overlay").remove();
                                                            $("#mainModal .modal-footer > button").removeAttr("disabled");
                                                            $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                                                        });
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                };
                Modal.create(data);
            }
            Number.prototype.duration = function() {
                let sec_num = parseInt(this, 10);
                let weeks = Math.floor((sec_num / 3600 / 24) / 7);
                let days = Math.floor((sec_num / 3600 / 24) % 7);
                let hours = Math.floor((sec_num / 3600) % 24);
                let minutes = Math.floor((sec_num / 60) % 60);
                let seconds = sec_num % 60;
                let duration = "";
                if (weeks >= 1) {
                    duration += weeks + (weeks >= 2 ? " Wochen, " : " Woche, ");
                }
                if (days >= 1) {
                    duration += days + (days >= 2 ? " Tage, " : " Tag, ");
                }
                if (hours >= 1) {
                    duration += hours + (hours >= 2 ? " Stunden, " : " Stunde, ");
                }
                if (minutes >= 1) {
                    duration += minutes + (minutes >= 2 ? " Minuten, " : " Minute, ");
                }
                if (seconds >= 1) {
                    duration += seconds + (seconds >= 2 ? " Sekunden, " : " Sekunde, ");
                }
                return duration.substr(0, duration.length -2);
            }
            $(window).on("load", function() {
                $("#body-overlay").empty();
                $("#body-overlay").css("opacity", 0).on("transitionend", function() {
                    $(this).remove();
                    $("body").removeClass("overflow-hidden");
                });
            }).on("resize", function() {
                if (visualViewport["width"] !== viewportWidth) {
                    viewportWidth = visualViewport["width"];
                }
            });
            $(document).on("DOMContentLoaded", function() {
                //dataTables["currentReservations"] = $("#currentReservationsTable").DataTable(dataTablesOptions["currentReservations"]);
                calendar = new FullCalendar.Calendar($("#calendar")[0], {
                    initialView: "dayGridMonth",
                    locale: "de",
                    events: "calendar.php",
                    nowIndicator: true,
                    selectable: true,
                    selectAllow: function(selectInfo) {
                        let currentDate = new Date();
                        currentDate.setHours(0, 0, 0);
                        return Math.trunc(selectInfo["start"].getTime() /1000) >= Math.trunc(currentDate.getTime() /1000);
                    },
                    dateClick: function(info) {
                        //console.log(info);
                    },
                    //
                    select: function(selectionInfo) {
                        let currentDate = new Date();
                        currentDate.setHours(0, 0, 0);
                        if (Math.trunc(selectionInfo["start"].getTime() /1000) >= Math.trunc(currentDate.getTime() /1000)) {
                            $("#createNewReservationButton").removeAttr("disabled").attr({"data-start": selectionInfo["startStr"], "data-end": selectionInfo["endStr"]});
                        }
                        else {
                            $("#createNewReservationButton").attr("disabled", "disabled");
                        }
                    },
                    /*unselect: function(jsEvent, view) {
                        $("#createNewReservationButton").attr("disabled", "disabled").removeAttr("data-start data-end");
                    },*/
                    eventClick: function(info) {
                        let eventData = calendar.getEventById(info["event"]["_def"]["publicId"]);
                        //"2022-02-08T10:10:00+01:00"
                        // Datumsformat ist ISO-Format, daher können Teile daraus einfach mit String-Methoden extrahiert werden.
                        // Beim Datum selber müssen zur Anzeige vielleicht verschiedene Formate benutzt werden.
                        let dateArray = eventData["startStr"].slice(0, 10).split("-");
                        let date = dateArray[2] + "." + dateArray[1] + "." + dateArray[0];
                        let startTime = eventData["startStr"].slice(11, 16) + " Uhr";
                        let endTime = (eventData["allDay"] ? "(Ganztägig)" : eventData["endStr"].slice(11, 16) + " Uhr");
                        let content = "<div class='row'><div class='col-md-3'>Beschreibung:</div><div class='col-md-9'>" + (eventData["title"] !== "" ? eventData["title"] : "(Nicht angegeben)") + "</div></div>";
                        content += "<div class='row mt-2'><div class='col-md-3'>Veranstalter:</div><div class='col-md-9'>" + (info["event"]["extendedProps"].hasOwnProperty("booker") ? info["event"]["extendedProps"]["booker"] : "(Nicht angegeben)") + "</div></div>";
                        content += "<div class='row mt-2'><div class='col-md-3'>Datum:</div><div class='col-md-9'>" + date + "</div></div>";
                        content += "<div class='row mt-2'><div class='col-md-3'>Start:</div><div class='col-md-9'>" + startTime + "</div></div>";
                        content += "<div class='row mt-2'><div class='col-md-3'>Ende:</div><div class='col-md-9'>" + endTime + "</div></div>";
                        content += "</div>";
                        let data = {
                        modal: {
                            name: "eventInfos"
                        },
                        title: {
                            text: "Termininformationen"
                        },
                        content: {
                            text: content,
                            options: {
                                scroll: true
                            }
                        }
                    };
                    Modal.create(data);
                    }
                });
                calendar.render();
                getBuildings();
                // Anhand von authToken soll ein Schlüssel (im Sinne eines Datenfeldes, nicht irgendetwas "Verschlüsseltes" zurückgesendet werden,
                // der den aktuellen Benutzer als Administrator oder normalen Benutzer identifiziert (oder auch als gar nichts, wenn man nicht angemeldet ist)
                /*setInterval(function() {
                    $.post("dataTables.php", {
                        _token: authToken
                    }).done(function(response) {
                        // Wenn man Adminstatus hat, Tabelle neu erstellen!
                        if (DataTable.isDataTable("#currentReservationsTable")) {
                            dataTables["currentReservations"].ajax.reload();
                        }
                    }).fail(function(response) {
                        $("#currentReservationsTable_wrapper").before(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                    }).always(function() {
                    });
                }, 5*60*1000);*/
                let date = new Date();
                $("footer").html("<a href='#'>&copy; " + (date.getFullYear() >= 2022 ? "2021-" + date.getFullYear() : date.getFullYear()) + " BSDGG/IN20/FIAE</a>");
                $("a[href='#systemInfos']").click(function() {
                    let content = "<table class='table-sm w-100'>";
                    content += "<thead>";
                    content += "<tr>";
                    content += "<th class='w-25'>Eigenschaft</th>";
                    content +=" <th>Wert</th>";
                    content += "</tr>";
                    content += "</thead>";
                    content += "<tbody id='systemInfosTable'>";
                    content += "</tbody>";
                    content += "</table>";
                    let data = {
                        modal: {
                            name: "systemInfos"
                        },
                        title: {
                            text: "Systeminformationen"
                        },
                        content: {
                            text: content,
                            options: {
                                scroll: true
                            }
                        }
                    };
                    Modal.create(data);
                    updateSystemInfos();
                });
                $("a[href='#login']").click(function() {
                    let content = "<div><label for='username' class='form-label'>Benutzername:</label>";
                    content += "<input type='text' class='form-control' id='username' placeholder='Benutzernamen eingeben'></div>";
                    content += "<div class='mt-3'><label for='password' class='form-label'>Passwort:</label>";
                    content += "<input type='password' class='form-control' id='password' placeholder='Passwort eingeben'></div>";
                    content += "<div class='d-flex mt-3 justify-content-between align-items-center'><button onclick='login(this)' class='btn btn-primary'>Anmelden";
                    content += "</button><a href='#'>Ich habe mein Passwort vergessen!</a></div>";
                    let data = {
                        modal: {
                            name: "login"
                        },
                        title: {
                            text: "Anmelden"
                        },
                        content: {
                            text: content
                        }
                    };
                    Modal.create(data);
                });
                $("#createNewReservationButton").click(function() {
                    let startDate = $(this).attr("data-start");
                    let endDate = $(this).attr("data-end");
                    console.log(startDate, endDate);
                    if (![null, undefined, "undefined"].includes(startDate) && ![null, undefined, "undefined"].includes(endDate)) {
                        dateArray = startDate.slice(0, 10).split("-");
                        let content = "<form><div class='row'><label class='col-md-3' for='newReservationBuildingSelect'>Gebäude:</label>";
                        content += "<select class='col-md-9 w-auto form-control fritz' id='newReservationBuildingSelect'></select></div>";
                        content += "<div class='row mt-3'><label class='col-md-3' for='newReservationRoomSelect'>Raum:</label>";
                        content += "<select class='col-md-9 w-auto form-control fritz' id='newReservationRoomSelect'></select></div>";
                        content += "<div class='row mt-3'><label class='col-md-3' for='newReservationDescription'>Beschreibung:</label>";
                        content += "<input type='text' class='col-md-9 w-auto form-control fritz' id='newReservationDescription'></div>";
                        content += "<div class='row mt-3'><label class='col-md-3' for='newReservationTimeFromHours'>Start:</label>";
                        content += "<div class='col-md-5 d-flex align-items-center align-content-center'><div class='input-group peter'><input type='text' class='form-control' onblur='checkHours(this)' maxlength='2' id='newReservationTimeFromHours' value='" + startDate.slice(11, 13) + "'>";
                        content += "<span class='input-group-text'>:</span><input type='text' class='form-control' onblur='checkMinutes(this)' maxlength='2' id='newReservationTimeFromMinutes' value='" + startDate.slice(14, 16) + "'></div>";
                        content += "<label class='ms-2' for='newReservationTimeFromMinutes'>Uhr</label></div></div>";
                        content += "<div class='row mt-3'><label class='col-md-3' for='newReservationTimeToHours'>Ende:</label>";
                        content += "<div class='col-md-5 d-flex align-items-center align-content-center'><div class='input-group peter'><input type='text' class='form-control' onblur='checkHours(this)' maxlength='2' id='newReservationTimeToHours'>";
                        content += "<span class='input-group-text'>:</span><input type='text' class='form-control' onblur='checkMinutes(this)' maxlength='2' id='newReservationTimeToMinutes'></div>";
                        content += "<label class='ms-2' for='newReservationTimeToMinutes'>Uhr</label></div><div class='d-flex align-items-center align-content-center ps-0 col-md-4 konrad'><input class='form-check-input mt-0' type='checkbox' id='newReservationAllDayCheckbox' name='newReservationAllDayCheckbox' value='1' onchange='toggleNewReservationTimes(this)'><label class='form-check-label ps-1' for='newReservationAllDayCheckbox'>Ganztätig</label></div>";
                        content += "</div></div></form>";
                        let data = {
                            modal: {
                                name: "newReservation",
                                static: true
                            },
                            title: {
                                text: "Neuen Termin erstellen am " + dateArray[2] + "." + dateArray[1] + "." + dateArray[0]
                            },
                            content: {
                                text: content
                            },
                            footer: {
                                buttons: {
                                    default: {
                                        text: "Abbrechen",
                                        class: "btn-danger"
                                    },
                                    custom: [
                                        {
                                            text: "Speichern",
                                            class: "btn-primary",
                                            attributes: {
                                                id: "saveNewReservationButton"
                                            },
                                            actions: [
                                                {
                                                    click: [
                                                        {
                                                            function: function() {
                                                                if ($("#body-overlay").length == 0) {
                                                                    $("body").prepend("<div id='body-overlay' style='background-color: transparent'></div>");
                                                                }
                                                                if ($("#saveNewReservationButton").find("[data-processing='true']").length == 0) {
                                                                    $("#saveNewReservationButton").prepend("<span class='spinner-border me-1 text-white kreiselchen align-text-bottom' data-processing='true'></span>");
                                                                }
                                                                $("#mainModal .modal-footer > button").attr("disabled", "disabled");
                                                                $("#mainModal .modal-header > [data-bs-dismiss='modal']").attr("disabled", "disabled");
                                                                $("#mainModal .modal-body > .alert").remove();
                                                                let data = {
                                                                    building: $("#newReservationBuildingSelect").val(),
                                                                    description: $("#newReservationDescription").val(),
                                                                    room: $("#newReservationRoomSelect").val(),
                                                                    from: [$("#newReservationTimeFromHours").val(), $("#newReservationTimeFromMinutes").val()],
                                                                    to: [$("#newReservationTimeToHours").val(), $("#newReservationTimeToMinutes").val()]
                                                                }
                                                                $.post("lol", {
                                                                    _token: authToken,
                                                                    data: JSON.stringify(data)
                                                                    //user: currentUser datenbank soll den nutzer selber anhand des tokens erkennen
                                                                }).done(function(response) {
                                                                }).fail(function(response) {
                                                                    $("#mainModal .modal-body").prepend(Alert.create("danger", response["status"] + ": " + response["statusText"]));
                                                                }).always(function() {
                                                                    $("#saveNewReservationButton").find("[data-processing='true']").remove();
                                                                    $("#saveNewReservationButton").removeAttr("disabled");
                                                                    $("#body-overlay").remove();
                                                                    $("#mainModal .modal-footer > button").removeAttr("disabled");
                                                                    $("#mainModal .modal-header > [data-bs-dismiss='modal']").removeAttr("disabled");
                                                                });
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            }
                        };
                        Modal.create(data);
                    }
                });
                $("a[href='#reservationsOverview']").on("shown.bs.tab", function() {
                    if (calendar !== null) {
                        calendar.updateSize();
                    }
                });
                // Nur für Admins sichtbar sein?
                /*
                $("a[href='#pastReservations']").on("shown.bs.tab", function() {
                    if (!DataTable.isDataTable("#pastReservationsTable")) {
                        dataTables["pastReservations"] = $("#pastReservationsTable").DataTable(dataTablesOptions["pastReservations"]);
                    }
                    else {
                        dataTables["pastReservations"].columns.adjust().draw();
                    }
                });
                */
                $("a[href='#administration']").on("shown.bs.tab", function() {
                    if ($("[href='#collapse-rooms']").attr("aria-expanded") === "true" && DataTable.isDataTable("#roomsAdminTable")) {
                        adminDataTables["rooms"].columns.adjust().draw();
                    }
                    if ($("[href='#collapse-roles']").attr("aria-expanded") === "true" && DataTable.isDataTable("#rolesAdminTable")) {
                        adminDataTables["roles"].columns.adjust().draw();
                    }
                    if ($("[href='#collapse-buildings']").attr("aria-expanded") === "true" && DataTable.isDataTable("#buildingsAdminTable")) {
                        adminDataTables["roles"].columns.adjust().draw();
                    }
                });
                $("#buildings-accordion").on("shown.bs.collapse", function() {
                    if (!DataTable.isDataTable("#buildingsAdminTable")) {
                        adminDataTables["users"] = $("#buildingsAdminTable").DataTable(dataTablesAdminOptions["buildings"]);
                    }
                    else {
                        $("#buildingsAdminTable").DataTable().ajax.reload();
                    }
                });
                $("#rooms-accordion").on("shown.bs.collapse", function() {
                    if (!DataTable.isDataTable("#usersAdminTable")) {
                        adminDataTables["users"] = $("#usersAdminTable").DataTable(dataTablesAdminOptions["users"]);
                    }
                    else {
                        $("#usersAdminTable").DataTable().ajax.reload();
                    }
                    if (buildings.length >= 1) {
                        $("#roomsBuildingSelect").empty().append("<option value='0'>Alle</option>");
                        for (building of buildings) {
                            $("#roomsBuildingSelect").append("<option value='" + building["id"] + "'>" + building["name"] + "</option>");
                        }
                    }
                });
                $("#roles-accordion").on("shown.bs.collapse", function() {
                    if (!DataTable.isDataTable("#rolesAdminTable")) {
                        let options = {};
                        Object.assign(options, dataTablesAdminOptions["roles"]);
                        options["rowGroup"] = {
                            dataSrc: "group",
                            className: "bg-gray-200",
                            endRender: null,
                            // Wird nach Erzeugung ausgelöst!
                            startRender: function(rows, group) {
                                return $("<tr>").append("<td colspan='2' class='align-middle' style='color: #282828'>" + group + "</td><td><button class='btn btn-sm btn-success' onclick='createNewUser(" + group + ")'><i class='fas fa-asterisk'></i> Neu...</button></td>");
                            }
                        };
                        options["orderFixed"] = [1, "asc"];
                        adminDataTables["roles"] = $("#rolesAdminTable").DataTable(options);
                    }
                    else {
                        $("#rolesAdminTable").DataTable().ajax.reload();
                    }
                });
                $("#rolesRoleSelect").change(function() {
                    let options = {};
                    let value = Number.parseInt($(this).val());
                    Object.assign(options, dataTablesAdminOptions["roles"]);
                    if (Number.parseInt($(this).attr("data-old")) >= 1 && value <= 0) {
                        options["rowGroup"] = {
                            dataSrc: "group",
                            className: "bg-gray-200",
                            endRender: null,
                            // Wird nach Erzeugung ausgelöst!
                            startRender: function(rows, group) {
                                return $("<tr>").append("<td colspan='2' class='align-middle' style='color: #282828'>" + group + "</td><td><button class='btn btn-sm btn-success' onclick='createNewUser(" + group + ")'><i class='fas fa-asterisk'></i> Neu...</button></td>");
                            }
                        };
                        options["orderFixed"] = [1, "asc"];
                    }
                    options["destroy"] = true;
                    if (value >= 1) {
                        options["ajax"]["data"]["category"] = value;
                        options["columns"][1]["visible"] = true;
                    }
                    else {
                        delete options["ajax"]["data"]["category"];
                        options["columns"][1]["visible"] = false;
                    }
                    $(this).attr("data-old", value);
                    adminDataTables["rolesAdminTable"] = $("#rolesAdminTable").DataTable(options).on("draw", function(settings) {
                        if (!adminDataTables["rolesAdminTable"].rowGroup().enabled()) {
                            if ($("#createNewUserButton").length == 0) {
                                $("#rolesAdminTable_wrapper > .row:last-of-type").before("<div class='d-flex justify-content-end mt-3 mb-3'><button type='button' class='btn btn-success' onclick='createNewUser()' id='createNewUserButton'><i class='fas fa-asterisk'></i> Neu...</button></div>");
                            }
                        }
                        else {
                            $("#createNewUserButton").remove();
                        }
                    });
                });
                $("#rooms-accordion").on("shown.bs.collapse", function() {
                    if (!DataTable.isDataTable("#roomsAdminTable")) {
                        let options = {};
                        Object.assign(options, dataTablesAdminOptions["rooms"]);
                        options["rowGroup"] = {
                            dataSrc: "building",
                            className: "bg-gray-200",
                            endRender: null,
                            // Wird nach Erzeugung ausgelöst!
                            startRender: function(rows, group) {
                                let index = buildings.findIndex(key => key["id"] === group);
                                return $("<tr>").append("<td colspan='3' class='align-middle' style='color: #282828'>" + (index >= 0 ? buildings[index]["name"] : "(Unbekannte Gebäude-ID: " + group + ")") + "</td><td><button class='btn btn-sm btn-success' onclick='createNewRoom(" + group + ")'><i class='fas fa-asterisk'></i> Neu...</button></td>");
                            }
                        };
                        options["orderFixed"] = [1, "asc"];
                        adminDataTables["rooms"] = $("#roomsAdminTable").DataTable(options);
                    }
                    else {
                        $("#roomsAdminTable").DataTable().ajax.reload();
                    }
                });
                $("#roomsBuildingSelect").change(function() {
                    let options = {};
                    let value = Number.parseInt($(this).val());
                    Object.assign(options, dataTablesAdminOptions["rooms"]);
                    if (Number.parseInt($(this).attr("data-old")) >= 1 && value <= 0) {
                        options["rowGroup"] = {
                            dataSrc: "building",
                            className: "bg-gray-200",
                            endRender: null,
                            // Wird nach Erzeugung ausgelöst!
                            startRender: function(rows, group) {
                                let index = buildings.findIndex(key => key["id"] === group);
                                return $("<tr>").append("<td colspan='3' class='align-middle' style='color: #282828'>" + (index >= 0 ? buildings[index]["name"] : "(Unbekannte Gebäude-ID: " + group + ")") + "</td><td><button class='btn btn-sm btn-success' onclick='createNewRoom(" + group + ")'><i class='fas fa-asterisk'></i> Neu...</button></td>");
                            }
                        };
                        options["orderFixed"] = [1, "asc"];
                    }
                    options["destroy"] = true;
                    if (value >= 1) {
                        options["ajax"]["data"]["category"] = value;
                        options["columns"][1]["visible"] = true;

                    }
                    else {
                        delete options["ajax"]["data"]["category"];
                        options["columns"][1]["visible"] = false;
                    }
                    $(this).attr("data-old", value);
                    adminDataTables["roomsAdminTable"] = $("#roomsAdminTable").DataTable(options).on("draw", function(settings) {
                        if (!adminDataTables["roomsAdminTable"].rowGroup().enabled()) {
                            if ($("#createNewRoomButton").length == 0) {
                                $("#roomsAdminTable_wrapper > .row:last-of-type").before("<div class='d-flex justify-content-end mt-3 mb-3'><button type='button' class='btn btn-success' onclick='createNewRoom()' id='createNewRoomButton'><i class='fas fa-asterisk'></i> Neu...</button></div>");
                            }
                        }
                        else {
                            $("#createNewRoomButton").remove();
                        }
                    });
                });
                /*
                const dateRangePicker = new Litepicker({
                    element: $("#currentReservationsTimeSelect")[0],
                    lang: "de-DE",
                    singleMode: false
                });*/
            });
        </script>
    </head>
    <body>
        <div id="body-overlay" class="m-0 p-0 overflow-hidden">
            <div class="spinner-border mr-2" style="border-width: 5px; color: var(--bs-gray-500)"></div>
        </div>
        <header>
            <nav class="navbar navbar-expand-sm p-0" id="navigation">
                <a class="navbar-brand ms-3 mb-0" href="#">
                    <div id="logo">LOL</div>
                </a>
                <ul class="navbar-nav" id="first-navbar">
                    <li class="nav-item">
                        <a class="nav-link rounded-3" href="#"><i class="fas fa-hdd"></i> Systeminformationen</a>
                    </li>
                </ul>
                <ul class="navbar-nav mt-auto mb-auto ms-auto" id="second-navbar">
                    <li class="nav-item d-none">
                        <a class="nav-link rounded-3" href="#"><i class="fas fa-sign-out-alt"></i> Abmelden</a>
                    </li>
                </ul>
                <div class="dropdown" id="mobile-navbar">
                    <button type="button" class="btn btn-outline-light dropdown-toggle" data-bs-toggle="dropdown" style="box-shadow: 0 0 1px 0 black">
                        <i class="fas fa-bars"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-hdd"></i> Systeminformationen</a></li>
                        <li><div class="dropdown-divider"></div></li> 
                        <li><a class="dropdown-item" href="#login"><i class="fas fa-sign-in-alt"></i> Anmelden</a></li>
                    </ul>
                </div> 
            </nav>
        </header>
        <main>
            <div class="row mt-4">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#reservationsOverview">Reservieren</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#moderation">Moderation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#administration">Administration</a>
                    </li>
                </ul>
                <div class="tab-content p-3">
                    <div class="tab-pane fade active show" id="reservationsOverview">
                        <div id="calendar"></div>
                        <div class="d-flex mt-3 justify-content-end">
                            <button type="button" class="btn btn-success" id="createNewReservationButton" disabled="disabled"><i class="fas fa-plus"></i> Neuer Termin</button>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="moderation">
                        <h3>Reservierungen genehmigen oder ablehnen</h3>
                        <div class="d-flex formContainer mb-3">
                            <label for="moderationRoomSelect" class="col-form-label me-2">Gebäude:</label>
                            <select class="form-select w-auto d-inline-block" id="moderationRoomSelect" data-old="0">
                                <option value="0">Alle</option>
                            </select>
                        </div>
                        <table class="table table-sm mt-3 w-100" id="currentReservationsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Raum</th>
                                    <th>Zeitpunkt</th>
                                    <th>Beschreibung</th>
                                    <th>Bucher</th>
                                    <th>Optionen</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="tab-pane fade" id="administration">
                        <section id="buildings-accordion" class="mb-3">
                            <div class="card">
                                <div class="card-header p-0">
                                    <a class="btn d-flex align-items-center" data-bs-toggle="collapse" href="#collapse-buildings" data-admin-table="buildings">
                                        <h4 class="ms-0 mt-auto me-auto mb-auto"><i class="fas fa-building"></i> Gebäude</h4>
                                        <i class="fas fa-chevron-down ms-auto mt-auto me-2 mb-auto"></i>
                                    </a>
                                </div>
                                <div id="collapse-buildings" class="collapse hide" data-bs-parent="#buildings-accordion">
                                    <div class="card-body">
                                        <table class="table table-sm w-100 mt-3" id="buildingsAdminTable">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Beschreibung</th>
                                                    <th>Optionen</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section id="rooms-accordion" class="mb-3">
                            <div class="card">
                                <div class="card-header p-0">
                                    <a class="btn d-flex align-items-center" data-bs-toggle="collapse" href="#collapse-rooms" data-admin-table="rooms">
                                        <h4 class="ms-0 mt-auto me-auto mb-auto"><i class="fas fa-door-open"></i> Räume</h4>
                                        <i class="fas fa-chevron-down ms-auto mt-auto me-2 mb-auto"></i>
                                    </a>
                                </div>
                                <div id="collapse-rooms" class="collapse hide" data-bs-parent="#rooms-accordion">
                                    <div class="card-body">
                                        <div class="d-flex formContainer mb-3">
                                            <label for="roomsBuildingSelect" class="col-form-label me-2">Gebäude:</label>
                                            <select class="form-select w-auto d-inline-block" id="roomsBuildingSelect" data-old="0">
                                                <option value="0">Alle</option>
                                            </select>
                                        </div>
                                        <table class="table table-sm w-100 mt-3" id="roomsAdminTable">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Gebäude</th>
                                                    <th>Name</th>
                                                    <th>Beschreibung</th>
                                                    <th>Optionen</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section id="roles-accordion" class="mb-3">
                            <div class="card">
                                <div class="card-header p-0">
                                    <a class="btn d-flex align-items-center" data-bs-toggle="collapse" href="#collapse-roles">
                                        <h4 class="ms-0 mt-auto me-auto mb-auto"><i class="fas fa-balance-scale"></i> Benutzerrollen</h4>
                                        <i class="fas fa-chevron-down ms-auto mt-auto me-2 mb-auto"></i>
                                    </a>
                                </div>
                                <div id="collapse-roles" class="collapse hide" data-bs-parent="#roles-accordion" data-admin-table="roles">
                                    <div class="card-body">
                                        <div class="d-flex formContainer mb-3">
                                            <label for="rolesRoleSelect" class="col-form-label me-2">Rolle:</label>
                                            <select class="form-select w-auto d-inline-block" id="rolesRoleSelect" data-old="0">
                                                <option value="0">Alle</option>
                                                <option value="1">Benutzer</option>
                                                <option value="2">Moderatoren</option>
                                                <option value="3">Administratoren</option>
                                            </select>
                                        </div>
                                        <table class="table table-sm w-100 mt-3" id="rolesAdminTable">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Rolle</th>
                                                    <th>Benutzer</th>
                                                    <th>Optionen</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
        <footer></footer>
        <div class="modal fade" id="mainModal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"></h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body"></div>
                    <div class="modal-footer"></div>
                </div>
            </div>
        </div>
    </body>
</html>